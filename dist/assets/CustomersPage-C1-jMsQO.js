import{d as x,e as V,g as i,i as r,j as v,t as N,l as p,m as g,x as C,f as c,M as Y,z as T,N as F,O as H,y as P,F as w,_ as J,B as W,P as X,Q as Z,s as M,c as $,o as ee,w as ae,C as te,a as le,b as oe,S as B,T as se}from"./index-CNMUdzAR.js";import{u as ne,a as ue,B as ie,T as re,P as de,_ as ce,s as me,b as ve,c as D,d as pe,e as fe,f as _e,S as ye,M as ge}from"./StatusFilter.vue_vue_type_script_setup_true_lang-D8VgU5Cl.js";import{f as Ve,c as Ce,a as be}from"./dataUtils-D26YddNY.js";import{B as U}from"./BaseButton-CiHY4qwR.js";import{_ as q}from"./BaseSelect.vue_vue_type_script_setup_true_lang-Dyd7NWUX.js";const he={key:0},ke={class:"align-right"},$e=["onMouseenter"],Se={key:1,class:"not-found"},Ie=x({__name:"CustomersTable",props:{data:{},searchedField:{}},setup(h){const n=h,{hoveredId:m,refsMap:d,setRef:t}=ne(),{itemsPerPage:_,currentPage:e,paginatedData:b}=ue(()=>n.data,()=>n.searchedField),f=[{key:"name",label:"Nome"},{key:"frequency",label:"Freq."},{key:"start",label:"Início"},{key:"plan",label:"Plano"},{key:"value",label:"Valor"},{key:"status",label:"Status"},{key:"actions",label:""}];return(o,s)=>{const S=N("font-awesome-icon");return p(),V("div",null,[i(b).length>0?(p(),V("div",he,[r(ie,{data:i(b),columns:f,rowKey:"id"},{"cell-start":v(({row:u})=>[g(C(i(Ve)(u.start)),1)]),"cell-value":v(({row:u})=>[g(" R$ "+C(u.value.toFixed(2).toString().replace(/\./g,",")),1)]),"cell-status":v(({row:u})=>[c("span",{class:Y(["status",{active:u.status==="Ativo",inactive:u.status==="Inativo"}])},C(u.status),3)]),"cell-actions":v(({row:u})=>[c("span",ke,[u.notes?(p(),V("span",{key:0,ref:k=>i(t)(u.id,k),onMouseenter:k=>m.value=u.id,onMouseleave:s[0]||(s[0]=k=>m.value=null)},[r(S,{icon:"fa-solid fa-circle-info",class:"table-icon"})],40,$e)):T("",!0),r(re,{anchor:i(d)[u.id],visible:i(m)===u.id},{default:v(()=>[g(C(u.notes),1)]),_:2},1032,["anchor","visible"]),r(S,{icon:"fa-solid fa-pen-to-square",class:"table-icon",onClick:k=>o.$emit("update-item",u)},null,8,["onClick"]),r(S,{icon:"fa-solid fa-trash-can",class:"table-icon",onClick:k=>o.$emit("delete-item",u)},null,8,["onClick"])])]),footer:v(()=>[r(de,{currentPage:i(e),"onUpdate:currentPage":s[1]||(s[1]=u=>F(e)?e.value=u:null),itemsPerPage:i(_),"onUpdate:itemsPerPage":s[2]||(s[2]=u=>F(_)?_.value=u:null),totalItems:o.data.length},null,8,["currentPage","itemsPerPage","totalItems"])]),_:1},8,["data"])])):(p(),V("div",Se," Nenhum resultado foi encontrado. "))])}}}),Me=["value","checked","id"],Pe=["for"],xe=x({__name:"BaseRadio",props:{label:{},modelValue:{},value:{},error:{}},emits:["update:modelValue"],setup(h,{emit:n}){const m=h,d=n,{updateValue:t}=me(m,{emit:d}),_=ve().getID();return(e,b)=>(p(),V(w,null,[c("input",H({type:"radio",class:"form-radio",value:e.value},{...e.$attrs,onChange:i(t)},{checked:e.modelValue===e.value,id:String(i(_))}),null,16,Me),e.label?(p(),V("label",{key:0,class:"form-label",for:String(i(_))},C(e.label),9,Pe)):T("",!0),e.error?(p(),P(ce,{key:1,id:`${String(i(_))}-error`},{default:v(()=>[g(C(e.error),1)]),_:1},8,["id"])):T("",!0)],64))}}),Ae=J(xe,[["__scopeId","data-v-8af36c35"]]),Be={class:"form-item"},Ue={class:"form-label"},De=x({__name:"BaseRadioGroup",props:{name:{},vertical:{type:Boolean},modelValue:{},options:{}},setup(h){return(n,m)=>(p(),V("div",Be,[c("label",Ue,C(n.name)+":",1),(p(!0),V(w,null,W(n.options,d=>(p(),P(Z(n.vertical?"div":"span"),{key:d.value,style:X(n.vertical?"":"margin-right: 20px;")},{default:v(()=>[r(Ae,{name:n.name,label:d.label,modelValue:n.modelValue,value:d.value,"onUpdate:modelValue":m[0]||(m[0]=t=>n.$emit("update:modelValue",t))},null,8,["name","label","modelValue","value"])]),_:2},1032,["style"]))),128))]))}}),Te=c("option",{value:"1x"},"1x",-1),Fe=c("option",{value:"2x"},"2x",-1),qe=c("option",{value:"3x"},"3x",-1),Ne=c("option",{value:"4x"},"4x",-1),we=c("option",{value:"5x"},"5x",-1),ze=c("option",{value:"Mensal"},"Mensal",-1),Re=c("option",{value:"Trimestral"},"Trimestral",-1),Ee=c("option",{value:"Semestral"},"Semestral",-1),Le=c("option",{value:"Anual"},"Anual",-1),je=x({__name:"CustomersForm",props:{modelValue:{}},emits:["update:modelValue"],setup(h,{expose:n,emit:m}){const d=h,t=m,_=M(null),e=$({get:()=>d.modelValue,set:f=>t("update:modelValue",f)}),b=$(()=>e.value.name.trim()!==""&&e.value.frequency!==""&&e.value.start!==""&&e.value.value!==null);return ee(()=>{var f;(f=_.value)==null||f.focus()}),n({isValid:b}),(f,o)=>(p(),V("form",{class:"form-area",onSubmit:o[7]||(o[7]=ae(()=>{},["prevent"]))},[r(D,{label:"Nome",modelValue:e.value.name,"onUpdate:modelValue":o[0]||(o[0]=s=>e.value.name=s),type:"text",ref_key:"firstInput",ref:_},null,8,["modelValue"]),r(q,{label:"Frequência",modelValue:e.value.frequency,"onUpdate:modelValue":o[1]||(o[1]=s=>e.value.frequency=s)},{default:v(()=>[Te,Fe,qe,Ne,we]),_:1},8,["modelValue"]),r(D,{label:"Data de Início",modelValue:e.value.start,"onUpdate:modelValue":o[2]||(o[2]=s=>e.value.start=s),type:"date"},null,8,["modelValue"]),r(q,{label:"Plano",modelValue:e.value.plan,"onUpdate:modelValue":o[3]||(o[3]=s=>e.value.plan=s)},{default:v(()=>[ze,Re,Ee,Le]),_:1},8,["modelValue"]),r(D,{label:"Valor",modelValue:e.value.value,"onUpdate:modelValue":o[4]||(o[4]=s=>e.value.value=s),type:"number"},null,8,["modelValue"]),r(De,{name:"Status",modelValue:e.value.status,"onUpdate:modelValue":o[5]||(o[5]=s=>e.value.status=s),options:[{label:"Ativo",value:"Ativo"},{label:"Inativo",value:"Inativo"}]},null,8,["modelValue"]),r(pe,{label:"Notas",modelValue:e.value.notes,"onUpdate:modelValue":o[6]||(o[6]=s=>e.value.notes=s)},null,8,["modelValue"])],32))}}),Oe={class:"content-area"},Ge={class:"flex space-between mb-normal"},Ke=c("span",{class:"text-add"},"Novo Cliente",-1),Qe={style:{display:"flex","justify-content":"flex-end"}},Ye={key:0,class:"message-area"},He={class:"highlight"},Je=c("strong",{class:"highlight"},"Inativo",-1),We={key:1,class:"message-area"},Xe={class:"highlight"},oa=x({__name:"CustomersPage",setup(h){const n=te(),m=le(),d=oe(),t=fe(),_=M([]),e=M("Ativo"),b=M(null),f=M({name:"",frequency:"",start:"",plan:"Mensal",value:null,status:"Ativo",notes:""}),o=$(()=>t.entity.value),s=$(()=>{var a;return((a=t.entity.value)==null?void 0:a.name)??""}),S=$(()=>{switch(t.mode.value){case"create":return"Adicionar Cliente";case"update":return"Atualizar Cliente";case"delete":return"Excluir Cliente";default:return""}}),u=$(()=>t.mode.value==="delete"&&t.deleteIsBlocked.value?"Inativar":"Confirmar"),k=$(()=>n.customers.filter(a=>e.value==="Todos"?!0:a.status===e.value)),z=()=>{t.deleteIsBlocked.value?Q():K()},I=()=>{t.close(),f.value={name:"",frequency:"",start:"",plan:"Mensal",value:null,status:"Ativo",notes:""}},R=a=>{f.value={name:a.name,frequency:a.frequency,start:a.start,plan:a.plan,value:a.value,status:a.status,notes:a.notes??""},t.openUpdate(a)},E=a=>{t.openDelete(a,!n.canDeleteCustomer(a.id))},L=async()=>{var l;if(!((l=b.value)!=null&&l.isValid))return;const a={...f.value,name:Ce(f.value.name)};t.mode.value==="create"?j(a):O(o.value.id,a)},j=async a=>{d.start();try{let l=await B.create(a);await n.fetchCustomers(),f.value.status==="Ativo"&&setTimeout(()=>{G(l)},500),I(),m.success("Cliente criado com sucesso!")}catch(l){m.error("Erro ao criar cliente.",l)}finally{d.stop()}},O=async(a,l)=>{d.start();try{await B.update(a,l),await n.fetchCustomers(),I(),m.success("Cliente atualizado com sucesso!")}catch(A){m.error("Erro ao atualizar cliente.",A)}finally{d.stop()}},G=async a=>{try{let l=be(a.start),y={customer:a.id,year:l.year,month:l.month,value:a.value,payment_day:Number(l.day),notes:a.notes,paid:"À pagar"};await se.create(y),await n.fetchRevenue()}catch(l){console.error("Erro ao criar receita.",l)}},K=async()=>{d.start();try{await B.delete(o.value.id),await n.fetchCustomers(),I(),m.success("Cliente excluído com sucesso")}catch(a){m.error("Erro ao excluir cliente.",a)}finally{d.stop()}},Q=async()=>{d.start();try{await B.update(o.value.id,{status:"Inativo"}),await n.fetchCustomers(),I(),m.success("Cliente inativado com sucesso!")}catch(a){m.error("Erro ao inativar cliente",a)}finally{d.stop()}};return(a,l)=>{const A=N("font-awesome-icon");return p(),V("div",Oe,[c("div",Ge,[r(U,{size:"lg",onClick:i(t).openCreate},{default:v(()=>[r(A,{icon:"fa-solid fa-plus",class:"icon-add"}),Ke]),_:1},8,["onClick"]),c("div",Qe,[r(_e,{modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=y=>e.value=y),options:["Ativo","Inativo","Todos"],defaultValue:"Ativo"},null,8,["modelValue"]),r(ye,{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=y=>_.value=y)},null,8,["modelValue"])])]),r(Ie,{data:k.value,searchedField:_.value,onUpdateItem:l[2]||(l[2]=y=>R(y)),onDeleteItem:E},null,8,["data","searchedField"]),r(ge,{modelValue:i(t).isOpen.value,"onUpdate:modelValue":l[4]||(l[4]=y=>i(t).isOpen.value=y)},{header:v(()=>[c("span",null,C(S.value),1)]),footer:v(()=>{var y;return[i(t).isDelete.value?(p(),P(U,{key:0,size:"lg",loading:i(d).isLoading,onClick:z},{default:v(()=>[g(C(u.value),1)]),_:1},8,["loading"])):(p(),P(U,{key:1,type:"submit",size:"lg",disabled:!((y=b.value)!=null&&y.isValid),loading:i(d).isLoading,onClick:L},{default:v(()=>[g(" Salvar ")]),_:1},8,["disabled","loading"])),r(U,{size:"lg",variant:"danger",onClick:I},{default:v(()=>[g(" Cancelar ")]),_:1})]}),default:v(()=>[i(t).isDelete.value&&i(t).deleteIsBlocked.value?(p(),V("p",Ye,[g(" Não é possível excluir o cliente "),c("strong",He,C(s.value),1),g(", pois isso excluiria todo o seu histórico de receitas. Ao invés de excluí-lo, mude seu status para "),Je,g(". ")])):i(t).isDelete.value?(p(),V("p",We,[g(" Tem certeza que deseja excluir o cliente "),c("strong",Xe,C(s.value),1),g("? ")])):(p(),P(je,{key:2,modelValue:f.value,"onUpdate:modelValue":l[3]||(l[3]=y=>f.value=y),ref_key:"formRef",ref:b},null,8,["modelValue"]))]),_:1},8,["modelValue"])])}}});export{oa as default};
