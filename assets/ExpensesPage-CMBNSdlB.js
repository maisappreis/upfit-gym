import{d as w,C as j,a as q,b as G,s as $,e as k,g as u,i as n,j as i,t as K,l as y,m as f,x as h,f as g,M as W,z as N,N as L,V as U,O as X,y as I,F as Z,c as D,o as ee,w as ae,_ as te}from"./index-BEoHMZof.js";import{d as H,u as le,a as se,B as oe,M as J,T as ne,P as re,_ as ue,S as de,U as ie,b as z,c as ce,e as me,f as pe}from"./StatusFilter.vue_vue_type_script_setup_true_lang-D_xOiOTt.js";import{f as ve,b as fe,d as ge,e as ye,c as Ve}from"./dataUtils-D26YddNY.js";import{B as x}from"./BaseButton-B61-gtKE.js";import{_ as _e}from"./DateFilter.vue_vue_type_script_setup_true_lang-Ck_mgYBA.js";const he={key:0},be=["onClick"],ke={class:"align-right"},$e=["onMouseenter"],Ce={key:1,class:"not-found"},Pe={class:"message-area"},Me=w({__name:"ExpensesTable",props:{data:{},searchedField:{}},emits:["update-item","delete-item"],setup(E,{emit:C}){const V=j(),c=q(),d=G(),_=E,m=H(),{hoveredId:o,refsMap:P,setRef:M}=le(),{itemsPerPage:p,currentPage:s,paginatedData:v}=se(()=>_.data,()=>_.searchedField),S=$(""),b=$(),T=[{key:"year",label:"Ano"},{key:"month",label:"Mês"},{key:"name",label:"Nome"},{key:"date",label:"Vencimento"},{key:"installments",label:"Parcelas"},{key:"value",label:"Valor"},{key:"paid",label:"Status"},{key:"actions",label:""}],B=r=>{switch(b.value=r,b.value.paid){case"À pagar":S.value="pago";break;case"Pago":S.value="à pagar";break}m.openUpdate(b.value)},F=()=>{m.close(),S.value=""},A=async()=>{d.start();try{let r={};switch(b.value.paid){case"À pagar":r={paid:"Pago"};break;case"Pago":r={paid:"À pagar"};break}await U.update(b.value.id,r),await V.fetchExpenses(),r.paid==="Pago"&&b.value.installments===""&&Y(b.value),F(),c.success("Status do pagamento salvo com sucesso!")}catch(r){console.error("Erro ao atualizar o status de pagamento...",r),c.error("Erro ao salvar o status do pagamento.",r)}finally{d.stop()}},Y=async r=>{try{let e=fe(r.month,r.year),t=parseInt(r.date.slice(-2)),a=`${e.year}-${e.monthNumber}-${t}`,l={year:e.year,month:e.month,name:r.name,date:a,value:r.value,paid:"À pagar",notes:r.notes};await U.create(l),await V.fetchExpenses()}catch(e){console.error("Erro ao criar despesa.",e)}};return(r,e)=>{const t=K("font-awesome-icon");return y(),k("div",null,[u(v).length>0?(y(),k("div",he,[n(oe,{data:u(v),columns:T,rowKey:"id"},{"cell-date":i(({row:a})=>[f(h(u(ve)(a.date)),1)]),"cell-value":i(({row:a})=>[f(" R$ "+h(a.value.toFixed(2).toString().replace(/\./g,",")),1)]),"cell-paid":i(({row:a})=>[g("span",{class:W(["status paid",{active:a.paid==="Pago",inactive:a.paid==="À pagar"}]),onClick:l=>B(a)},h(a.paid),11,be)]),"cell-actions":i(({row:a})=>[g("span",ke,[a.notes?(y(),k("span",{key:0,ref:l=>u(M)(a.id,l),onMouseenter:l=>o.value=a.id,onMouseleave:e[0]||(e[0]=l=>o.value=null)},[n(t,{icon:"fa-solid fa-circle-info",class:"table-icon"})],40,$e)):N("",!0),n(ne,{anchor:u(P)[a.id],visible:u(o)===a.id},{default:i(()=>[f(h(a.notes),1)]),_:2},1032,["anchor","visible"]),n(t,{icon:"fa-solid fa-pen-to-square",class:"table-icon",onClick:l=>r.$emit("update-item",a)},null,8,["onClick"]),n(t,{icon:"fa-solid fa-trash-can",class:"table-icon",onClick:l=>r.$emit("delete-item",a)},null,8,["onClick"])])]),footer:i(()=>[n(re,{currentPage:u(s),"onUpdate:currentPage":e[1]||(e[1]=a=>L(s)?s.value=a:null),itemsPerPage:u(p),"onUpdate:itemsPerPage":e[2]||(e[2]=a=>L(p)?p.value=a:null),totalItems:r.data.length},null,8,["currentPage","itemsPerPage","totalItems"])]),_:1},8,["data"])])):(y(),k("div",Ce," Nenhum resultado foi encontrado. ")),n(J,{modelValue:u(m).isOpen.value,"onUpdate:modelValue":e[3]||(e[3]=a=>u(m).isOpen.value=a)},{header:i(()=>[g("span",null,[f(" Marcar como "),g("strong",null,h(S.value),1)])]),footer:i(()=>[n(x,{size:"lg",loading:u(d).isLoading,onClick:A},{default:i(()=>[f(" Confirmar ")]),_:1},8,["loading"]),n(x,{size:"lg",variant:"danger",onClick:F},{default:i(()=>[f(" Cancelar ")]),_:1})]),default:i(()=>[g("p",Pe,[f(" Gostaria de marcar essa conta como "),g("strong",null,h(S.value),1),f("? ")])]),_:1},8,["modelValue"])])}}}),Se={class:"form-item"},Ee=["for"],xe=["checked","id"],De=w({__name:"BaseCheckbox",props:{label:{},error:{},modelValue:{type:Boolean}},emits:["update:modelValue"],setup(E,{emit:C}){const V=E,c=C,{updateValue:d}=de(V,{emit:c}),_=ie().getID();return(m,o)=>(y(),k(Z,null,[g("div",Se,[m.label?(y(),k("label",{key:0,for:String(u(_)),class:"form-label"},h(m.label),9,Ee)):N("",!0),g("input",X({...m.$attrs,onChange:u(d)},{checked:m.modelValue,id:String(u(_)),type:"checkbox"}),null,16,xe)]),m.error?(y(),I(ue,{key:0,id:`${u(_)}-error`},{default:i(()=>[f(h(m.error),1)]),_:1},8,["id"])):N("",!0)],64))}}),Ue={key:0},Ne={key:1,class:"invalid"},Fe=w({__name:"ExpensesForm",props:{modelValue:{}},emits:["update:modalValue"],setup(E,{expose:C,emit:V}){const c=$(!1),d=E,_=V,m=$(null),o=D({get:()=>d.modelValue,set:p=>_("update:modalValue",p)}),P=D(()=>o.value.name.trim()!==""&&o.value.date!==""&&o.value.value!==null),M=D(()=>c.value===!0&&!Number.isInteger(Number(o.value.installments)));return ee(()=>{var p;(p=m.value)==null||p.focus()}),C({isValid:P}),(p,s)=>(y(),k("form",{class:"form-area",onSubmit:s[6]||(s[6]=ae(()=>{},["prevent"]))},[n(z,{label:"Nome",modelValue:o.value.name,"onUpdate:modelValue":s[0]||(s[0]=v=>o.value.name=v),type:"text",ref_key:"firstInput",ref:m},null,8,["modelValue"]),n(z,{label:"Data de Vencimento",modelValue:o.value.date,"onUpdate:modelValue":s[1]||(s[1]=v=>o.value.date=v),type:"date"},null,8,["modelValue"]),n(De,{label:"Possui parcelas?",modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=v=>c.value=v)},null,8,["modelValue"]),c.value?(y(),k("div",Ue,[n(z,{label:"Número de parcelas",modelValue:o.value.installments,"onUpdate:modelValue":s[3]||(s[3]=v=>o.value.installments=v),type:"number"},null,8,["modelValue"])])):N("",!0),M.value?(y(),k("p",Ne,"Parcelas inválidas.")):N("",!0),n(z,{label:"Valor",modelValue:o.value.value,"onUpdate:modelValue":s[4]||(s[4]=v=>o.value.value=v),type:"number"},null,8,["modelValue"]),n(ce,{label:"Notas",modelValue:o.value.notes,"onUpdate:modelValue":s[5]||(s[5]=v=>o.value.notes=v)},null,8,["modelValue"])],32))}}),ze=te(Fe,[["__scopeId","data-v-8a31996f"]]),Ie={class:"content-area"},we={class:"flex space-between mb-normal"},Te=g("span",{class:"text-add"},"Nova Despesa",-1),Be={style:{display:"flex","justify-content":"flex-end"}},Ae={key:0,class:"message-area"},Ye={class:"highlight"},Oe={class:"highlight"},Re={class:"highlight"},He=w({__name:"ExpensesPage",setup(E){const C=j(),V=q(),c=G(),d=H(),_=$([]),m=$(""),o=$(0),P=$(""),M=$(null),p=$({name:"",month:"",date:"",paid:"À pagar",value:null,year:0,installments:"",notes:""}),s=D(()=>d.entity.value),v=D(()=>{switch(d.mode.value){case"create":return"Adicionar Despesa";case"update":return"Atualizar Despesa";case"delete":return"Excluir Despesa";default:return""}}),S=D(()=>ge(C.expenses,{currentMonth:m.value,currentYear:o.value,currentStatus:P.value})),b=()=>{d.close(),p.value={name:"",month:"",date:"",paid:"À pagar",value:null,year:0,installments:"",notes:""}},T=e=>{p.value={name:e.name,month:e.month,date:e.date,paid:e.paid,value:e.value,year:e.year,installments:e.installments,notes:e.notes},d.openUpdate(e)},B=e=>{d.openDelete(e)},F=async()=>{var a;if(!((a=M.value)!=null&&a.isValid))return;let e=ye(p.value.date);const t={...p.value,name:Ve(p.value.name),year:e.year,month:e.month};d.mode.value==="create"?A(t):Y(s.value.id,t)},A=async e=>{c.start();try{await U.create(e),await C.fetchExpenses(),b(),V.success("Despesa criada com sucesso!")}catch(t){V.error("Erro ao criar despesa.",t)}finally{c.stop()}},Y=async(e,t)=>{c.start();try{await U.update(e,t),await C.fetchExpenses(),b(),V.success("Despesa atualizada com sucesso!")}catch(a){V.error("Erro ao atualizar despesa.",a)}finally{c.stop()}},r=async()=>{c.start();try{await U.delete(s.value.id),await C.fetchExpenses(),V.success("Despesa excluída com sucesso!"),d.close()}catch(e){V.error("Erro ao excluir despesa.",e)}finally{c.stop()}};return(e,t)=>{const a=K("font-awesome-icon");return y(),k("div",Ie,[g("div",we,[n(x,{size:"lg",onClick:u(d).openCreate},{default:i(()=>[n(a,{icon:"fa-solid fa-plus",class:"icon-add"}),Te]),_:1},8,["onClick"]),g("div",Be,[n(_e,{modelValueMonth:m.value,"onUpdate:modelValueMonth":t[0]||(t[0]=l=>m.value=l),modelValueYear:o.value,"onUpdate:modelValueYear":t[1]||(t[1]=l=>o.value=l)},null,8,["modelValueMonth","modelValueYear"]),n(me,{modelValue:P.value,"onUpdate:modelValue":t[2]||(t[2]=l=>P.value=l),options:["Pago","À pagar","Todos"],defaultValue:"Todos"},null,8,["modelValue"]),n(pe,{modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=l=>_.value=l)},null,8,["modelValue"])])]),n(Me,{data:S.value,searchedField:_.value,onUpdateItem:t[4]||(t[4]=l=>T(l)),onDeleteItem:t[5]||(t[5]=l=>B(l))},null,8,["data","searchedField"]),n(J,{modelValue:u(d).isOpen.value,"onUpdate:modelValue":t[7]||(t[7]=l=>u(d).isOpen.value=l)},{header:i(()=>[g("span",null,h(v.value),1)]),footer:i(()=>{var l;return[u(d).isDelete.value?(y(),I(x,{key:0,size:"lg",loading:u(c).isLoading,onClick:r},{default:i(()=>[f(" Confirmar ")]),_:1},8,["loading"])):(y(),I(x,{key:1,type:"submit",size:"lg",disabled:!((l=M.value)!=null&&l.isValid),loading:u(c).isLoading,onClick:F},{default:i(()=>[f(" Salvar ")]),_:1},8,["disabled","loading"])),n(x,{size:"lg",variant:"danger",onClick:b},{default:i(()=>[f(" Cancelar ")]),_:1})]}),default:i(()=>{var l,O,R;return[u(d).isDelete.value?(y(),k("p",Ae,[f(" Tem certeza que deseja excluir o pagamento da despesa de "),g("strong",Ye,h((l=s.value)==null?void 0:l.name),1),f(" referente ao mês de "),g("strong",Oe,h((O=s.value)==null?void 0:O.month),1),f(" de "),g("strong",Re,h((R=s.value)==null?void 0:R.year),1),f("? ")])):(y(),I(ze,{key:1,modelValue:p.value,"onUpdate:modelValue":t[6]||(t[6]=Q=>p.value=Q),ref_key:"formRef",ref:M},null,8,["modelValue"]))]}),_:1},8,["modelValue"])])}}});export{He as default};
